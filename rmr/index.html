<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

    <script>
      function calcRmr(age, isMale, weight, height, isDiabetic) {
        if (age === "" || weight === "" || height === "" || isMale === undefined) {
          return undefined;
        };
        return 71.767
          - 2.337*age
          + 257.293*!!isMale
          + 9.996*weight
          + 4.132*height
          + 145.959*!!isDiabetic;
      };

      function calcBmi(weight, height /* cm, not m! */) {
        if (weight === "" || height === "") { return undefined; };
        return weight / Math.pow(height/100, 2);
      };

      function rmrWarnings(age, weight, height) {
        let warnings = [];
        let bmi = calcBmi(weight, height);
        if (bmi < 35) {
          warnings.push('BMI under 35 -- this model was validated with BMI 35+ patients only');
        }
        if (age !== "" && age < 18) {
          warnings.push('Patient is not an adult -- this model was validated with adult patients only');
        }
        return warnings;
      };

      function update() {
        // Load values
        let age = document.getElementById("age").value;
        let isMale = document.getElementById("male").checked;
        if (isMale == false && document.getElementById("female").checked == false) {
          // We haven't selected a gender yet
          isMale = undefined;
        }
        let weight = document.getElementById("weight").value;
        let height = document.getElementById("height").value;
        let isDiabetic = document.getElementById("diabetesYes").checked;

        let rmr = calcRmr(age, isMale, weight, height, isDiabetic);
        if (rmr === undefined) {
          rmr = "";
        } else {
          rmr = Math.round(rmr, 0);
        }
        document.getElementById("rmr").innerHTML = rmr;

        let bmi = calcBmi(weight, height);
        if (bmi === undefined) {
          bmi = "";
        } else {
          bmi = Math.round(bmi, 1);
        }
        document.getElementById("bmi").innerHTML = bmi;

        let warnings = rmrWarnings(age, weight, height);
        if (warnings.length > 0) {
          document.getElementById("warningsContainer").style.display = "";
          let list = document.getElementById("warnings")
          list.innerHTML = '';
          warnings.forEach(function(warning) {
            let el = document.createElement('li');
            el.appendChild(document.createTextNode(warning));
            list.appendChild(el);
          });
        } else {
          document.getElementById("warningsContainer").style.display = "none";
        };
      }
    </script>

  </head>
  <body>
    <div class="container">
      <h1 class="text-center">Resting Metabolic Rate Calculator</h1>
      <form>
        <div class="form-group">
          <label for="age">Age</label>
          <input class="form-control" type="number" id="age" onchange="update()" onkeyup="update()" autofocus="true">
        </div>
        <div class="form-group">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="gender" id="female" onchange="update()">
            <label class="form-check-label" for="female">Female</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="gender" id="male" onchange="update()">
            <label class="form-check-label" for="male">Male</label>
          </div>
        </div>
        <div class="form-group">
          <label for="weight">Weight (kg)</label>
          <input class="form-control" type="number" id="weight" onchange="update()" onkeyup="update()">
        </div>
        <div class="form-group">
          <label for="height">Height</label>
          <input class="form-control" type="number" id="height" onchange="update()" onkeyup="update()">
        </div>
        <div class="form-group">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="diabetes" id="diabetesNo" onchange="update()" checked="true">
            <label class="form-check-label" for="diabetesNo">No diabetes</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="diabetes" id="diabetesYes" onchange="update()">
            <label class="form-check-label" for="diabetesYes">Type 2 diabetes</label>
          </div>
        </div>
      </form>
      <h4>
        BMI
      </h4>
      <p class="lead" id="bmi"></p>
      <h4>
        Resting Metabolic Rate
      </h4>
      <p class="lead" id="rmr"></p>

      <div id="warningsContainer" style="display: none;">
        <h4>
          Warnings
        </h4>
        <ul id="warnings">
        </ul>
      </div>
      <h2>References</h2>
      <p>
        Based on research by <a href="https://www.ncbi.nlm.nih.gov/pubmed/15166305">Huang et al</a>.
      </p>
      <p>
        <small>Created by <a href="https://github.com/alexjurkiewicz">Alex Jurkiewicz</a></small>
      </p>

    <div>
  </body>
</html>
